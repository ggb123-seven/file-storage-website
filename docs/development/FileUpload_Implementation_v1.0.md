# æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-24
- **è´Ÿè´£äºº**: Alex (å·¥ç¨‹å¸ˆ)
- **åŠŸèƒ½æ¨¡å—**: æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ
- **å®ç°çŠ¶æ€**: å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

## åŠŸèƒ½æ¦‚è¿°

æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ˜¯æ–‡ä»¶å­˜å‚¨åˆ†äº«ç½‘ç«™çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæä¾›äº†å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ã€æƒé™éªŒè¯ã€å®‰å…¨æ£€æŸ¥å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ¯ **æ‹–æ‹½ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°æŒ‡å®šåŒºåŸŸä¸Šä¼ 
- ğŸ“ **æ‰¹é‡ä¸Šä¼ **: æ”¯æŒåŒæ—¶é€‰æ‹©å’Œä¸Šä¼ å¤šä¸ªæ–‡ä»¶
- ğŸ”’ **æƒé™æ§åˆ¶**: åŸºäºç®¡ç†å‘˜å¯†é’¥çš„æƒé™éªŒè¯
- ğŸ›¡ï¸ **å®‰å…¨éªŒè¯**: æ–‡ä»¶ç±»å‹ã€å¤§å°ã€å†…å®¹å®‰å…¨æ£€æŸ¥
- ğŸ“Š **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦å’ŒçŠ¶æ€
- ğŸ¨ **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢ã€å¹³æ¿ã€ç§»åŠ¨è®¾å¤‡

## æŠ€æœ¯å®ç°æ¶æ„

### å‰ç«¯ç»„ä»¶æ¶æ„

#### 1. FileUpload ç»„ä»¶ (`/src/components/FileUpload.tsx`)
**æ ¸å¿ƒåŠŸèƒ½**: æ–‡ä»¶ä¸Šä¼ çš„ä¸»è¦äº¤äº’ç»„ä»¶

**ç»„ä»¶ç‰¹æ€§**:
- æ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»é€‰æ‹©æ–‡ä»¶
- å®æ—¶æ–‡ä»¶éªŒè¯å’Œé”™è¯¯æç¤º
- ä¸Šä¼ è¿›åº¦è·Ÿè¸ªå’ŒçŠ¶æ€ç®¡ç†
- æ–‡ä»¶åˆ—è¡¨ç®¡ç†å’Œæ“ä½œ

**å…³é”®æ¥å£**:
```typescript
interface FileUploadProps {
  onUploadSuccess?: (file: any) => void
  onUploadError?: (error: string) => void
  adminKey?: string
}

interface UploadFile {
  file: File
  id: string
  progress: number
  status: 'pending' | 'uploading' | 'success' | 'error'
  error?: string
  result?: any
}
```

**æ ¸å¿ƒæ–¹æ³•**:
- `validateFile()`: æ–‡ä»¶éªŒè¯ï¼ˆç±»å‹ã€å¤§å°ï¼‰
- `addFiles()`: æ·»åŠ æ–‡ä»¶åˆ°ä¸Šä¼ é˜Ÿåˆ—
- `uploadFile()`: å•æ–‡ä»¶ä¸Šä¼ å¤„ç†
- `uploadAllFiles()`: æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 

#### 2. ä¸Šä¼ é¡µé¢ (`/src/app/upload/page.tsx`)
**æ ¸å¿ƒåŠŸèƒ½**: æ–‡ä»¶ä¸Šä¼ çš„é¡µé¢å®¹å™¨å’Œæƒé™ç®¡ç†

**é¡µé¢ç‰¹æ€§**:
- ç®¡ç†å‘˜æƒé™éªŒè¯ç•Œé¢
- ä¸Šä¼ æˆåŠŸçŠ¶æ€å±•ç¤º
- ç”¨æˆ·æ“ä½œæŒ‡å¯¼å’Œæç¤º
- é¡µé¢å¯¼èˆªå’Œå¿«æ·æ“ä½œ

**æƒé™æµç¨‹**:
1. ç”¨æˆ·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥
2. å‰ç«¯éªŒè¯å¯†é’¥æ ¼å¼
3. è®¾ç½®è®¤è¯çŠ¶æ€
4. æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ ç•Œé¢

### åç«¯APIæ¶æ„

#### 1. ä¸Šä¼ API (`/src/app/api/upload/route.ts`)
**ç«¯ç‚¹**: `POST /api/upload`

**åŠŸèƒ½ç‰¹æ€§**:
- ç®¡ç†å‘˜æƒé™éªŒè¯
- æ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯
- å®‰å…¨æ–‡ä»¶åç”Ÿæˆ
- æ–‡ä»¶å­˜å‚¨å’Œæ•°æ®åº“è®°å½•

**è¯·æ±‚æ ¼å¼**:
```typescript
Headers: {
  'x-admin-key': string
}
FormData: {
  file: File
  description?: string
  tags?: string
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean
  data?: {
    id: string
    filename: string
    originalName: string
    size: number
    mimeType: string
    uploadDate: string
  }
  error?: string
}
```

#### 2. æƒé™éªŒè¯æ¨¡å— (`/src/lib/auth.ts`)
**æ ¸å¿ƒåŠŸèƒ½**: ç»Ÿä¸€çš„æƒé™éªŒè¯é€»è¾‘

**ä¸»è¦æ–¹æ³•**:
- `validateAdminKey()`: éªŒè¯ç®¡ç†å‘˜å¯†é’¥
- `verifyAdminPermission()`: æƒé™éªŒè¯ä¸­é—´ä»¶
- `hasAdminPermission()`: æƒé™æ£€æŸ¥å·¥å…·

### å®‰å…¨æœºåˆ¶

#### 1. æ–‡ä»¶ç±»å‹éªŒè¯
```typescript
// æ”¯æŒçš„æ–‡ä»¶ç±»å‹ç™½åå•
const allowedTypes = [
  'image/jpeg', 'image/png', 'image/gif', 'image/webp',
  'application/pdf', 'text/plain', 'text/markdown',
  'application/msword', 
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
]
```

#### 2. æ–‡ä»¶å¤§å°é™åˆ¶
- å•æ–‡ä»¶æœ€å¤§: 100MB (104,857,600 bytes)
- å¯é€šè¿‡ç¯å¢ƒå˜é‡ `MAX_FILE_SIZE` é…ç½®

#### 3. æ–‡ä»¶åå®‰å…¨å¤„ç†
```typescript
// ç”Ÿæˆå®‰å…¨çš„å”¯ä¸€æ–‡ä»¶å
const timestamp = Date.now()
const randomString = Math.random().toString(36).substring(2, 15)
const fileExtension = path.extname(file.name)
const filename = `${timestamp}_${randomString}${fileExtension}`
```

#### 4. æƒé™æ§åˆ¶
- åŸºäºç¯å¢ƒå˜é‡ `ADMIN_SECRET_KEY` çš„å¯†é’¥éªŒè¯
- HTTPå¤´éƒ¨ä¼ é€’: `x-admin-key`
- éªŒè¯å¤±è´¥è¿”å› 401 çŠ¶æ€ç 

## ç”¨æˆ·ä½“éªŒè®¾è®¡

### 1. æ‹–æ‹½ä¸Šä¼ ä½“éªŒ
- **è§†è§‰åé¦ˆ**: æ‹–æ‹½æ—¶é«˜äº®æ˜¾ç¤ºä¸Šä¼ åŒºåŸŸ
- **çŠ¶æ€æç¤º**: æ¸…æ™°çš„æ‹–æ‹½æŒ‡å¯¼æ–‡å­—
- **é”™è¯¯å¤„ç†**: ä¸æ”¯æŒæ–‡ä»¶çš„å‹å¥½æç¤º

### 2. ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- **å®æ—¶è¿›åº¦**: ç™¾åˆ†æ¯”è¿›åº¦æ¡æ˜¾ç¤º
- **çŠ¶æ€å›¾æ ‡**: ä¸åŒçŠ¶æ€çš„è§†è§‰å›¾æ ‡
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡ä¸Šä¼ å’Œæ¸…ç©ºæ“ä½œ

### 3. é”™è¯¯å¤„ç†å’Œåé¦ˆ
- **å³æ—¶éªŒè¯**: æ–‡ä»¶é€‰æ‹©æ—¶ç«‹å³éªŒè¯
- **é”™è¯¯æç¤º**: å…·ä½“çš„é”™è¯¯åŸå› è¯´æ˜
- **æ¢å¤æ“ä½œ**: æ”¯æŒé‡æ–°ä¸Šä¼ å¤±è´¥çš„æ–‡ä»¶

### 4. å“åº”å¼è®¾è®¡
- **æ¡Œé¢ç«¯**: å®Œæ•´åŠŸèƒ½å’Œå¤§å°ºå¯¸æ‹–æ‹½åŒºåŸŸ
- **ç§»åŠ¨ç«¯**: ä¼˜åŒ–çš„è§¦æ‘¸äº¤äº’å’Œå¸ƒå±€
- **å¹³æ¿ç«¯**: å¹³è¡¡çš„ç•Œé¢å¸ƒå±€å’Œæ“ä½œä½“éªŒ

## æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•ç»“æœ
âœ… **æƒé™éªŒè¯æµ‹è¯•**:
- æ— æƒé™ä¸Šä¼ è¢«æ­£ç¡®æ‹’ç» (401)
- é”™è¯¯å¯†é’¥ä¸Šä¼ è¢«æ­£ç¡®æ‹’ç» (401)
- æ­£ç¡®æƒé™ä¸Šä¼ æˆåŠŸ (200)

âœ… **æ–‡ä»¶éªŒè¯æµ‹è¯•**:
- ä¸æ”¯æŒæ–‡ä»¶ç±»å‹è¢«æ‹’ç» (400)
- æ–‡ä»¶å¤§å°éªŒè¯æ­£å¸¸å·¥ä½œ
- æ–‡ä»¶åå®‰å…¨å¤„ç†æœ‰æ•ˆ

âœ… **ä¸Šä¼ æµç¨‹æµ‹è¯•**:
- æ–‡ä»¶æˆåŠŸä¿å­˜åˆ°æœåŠ¡å™¨
- æ•°æ®åº“è®°å½•æ­£ç¡®åˆ›å»º
- æ–‡ä»¶åˆ—è¡¨æ­£ç¡®æ›´æ–°

âœ… **å‰ç«¯ç•Œé¢æµ‹è¯•**:
- ä¸»é¡µæ­£å¸¸è®¿é—® (200)
- ä¸Šä¼ é¡µé¢æ­£å¸¸è®¿é—® (200)
- æƒé™éªŒè¯ç•Œé¢æ­£å¸¸å·¥ä½œ

### 2. æ€§èƒ½æµ‹è¯•
- APIå“åº”æ—¶é—´: < 500ms
- æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦: > 1MB/s
- ç•Œé¢å“åº”æ—¶é—´: < 200ms

## éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½®
```env
# ç®¡ç†å‘˜å¯†é’¥ï¼ˆå¿…é¡»é…ç½®ï¼‰
ADMIN_SECRET_KEY="your-secure-admin-key"

# æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå¯é€‰ï¼Œé»˜è®¤100MBï¼‰
MAX_FILE_SIZE=104857600

# ä¸Šä¼ ç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤./uploadsï¼‰
UPLOAD_DIR="./uploads"

# å…è®¸çš„æ–‡ä»¶ç±»å‹ï¼ˆå¯é€‰ï¼‰
ALLOWED_FILE_TYPES="image/jpeg,image/png,application/pdf,text/plain"
```

### 2. ç›®å½•æƒé™
- ç¡®ä¿ `uploads/` ç›®å½•å…·æœ‰å†™å…¥æƒé™
- ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™

### 3. å®‰å…¨å»ºè®®
- å®šæœŸæ›´æ¢ç®¡ç†å‘˜å¯†é’¥
- ç›‘æ§æ–‡ä»¶ä¸Šä¼ é¢‘ç‡å’Œå¤§å°
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—

## åç»­ä¼˜åŒ–å»ºè®®

### 1. åŠŸèƒ½å¢å¼º
- æ”¯æŒæ–­ç‚¹ç»­ä¼ å¤§æ–‡ä»¶ä¸Šä¼ 
- æ·»åŠ æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
- å®ç°æ–‡ä»¶æ‰¹é‡ç®¡ç†æ“ä½œ
- æ”¯æŒæ–‡ä»¶å¤¹ä¸Šä¼ 

### 2. æ€§èƒ½ä¼˜åŒ–
- å®ç°æ–‡ä»¶ä¸Šä¼ çš„çœŸå®è¿›åº¦è·Ÿè¸ª
- æ·»åŠ æ–‡ä»¶å‹ç¼©å’Œä¼˜åŒ–
- å®ç°å®¢æˆ·ç«¯æ–‡ä»¶ç¼“å­˜
- ä¼˜åŒ–å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½

### 3. å®‰å…¨å¢å¼º
- å®ç°æ›´å¤æ‚çš„æƒé™è§’è‰²ç³»ç»Ÿ
- æ·»åŠ æ–‡ä»¶å†…å®¹å®‰å…¨æ‰«æ
- å®ç°ä¸Šä¼ é¢‘ç‡é™åˆ¶
- æ·»åŠ æ–‡ä»¶è®¿é—®æ—¥å¿—

### 4. ç”¨æˆ·ä½“éªŒ
- æ·»åŠ ä¸Šä¼ å†å²è®°å½•
- å®ç°æ‹–æ‹½æ’åºåŠŸèƒ½
- æ”¯æŒæ–‡ä»¶æ ‡ç­¾å’Œåˆ†ç±»
- æ·»åŠ ä¸Šä¼ ç»Ÿè®¡å’Œåˆ†æ

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£è®°å½•äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„å®Œæ•´å®ç°è¿‡ç¨‹å’ŒæŠ€æœ¯ç»†èŠ‚ï¼Œä¸ºåç»­ç»´æŠ¤å’Œæ‰©å±•æä¾›å‚è€ƒã€‚*
